<div id="record">
	
	<div class="addRecord">
		<div class="table  {{addData.cashType == 1 ? 'row-income' : 'row-cost' }}">
			<div class="td td-add">
				<div class="btn-add" ng-click="addRecord(addData)">
					<div class="btn-add-word">{{i18n.record.add}}</div>
				</div>
			</div>
			<div class="td td-type">
				<select id="cashType" ng-change="cleanTypes(addData)" ng-model="addData.cashType">
					<option value="-1">{{i18n.record.cost}}</option>
					<option value="1">{{i18n.record.income}}</option>
				</select>
			</div>
			<div class="td td-value {{addData.invalidValue?'error':''}}">
				<input ng-model="addData.value" placeholder="{{i18n.record.value_placeholder}}">
			</div>
			<div class="td">
				<select id="typeList" ng-model="addData.cid"  ng-options="currency.cid as str.to_cid(currency) for currency in currencyQuickSelectList()">
				</select>
			</div>
			<div class="td {{addData.invalidDate?'error':''}}">
				<input class="cell" type="date" placeholder="{{i18n.record.date_placeholder}}" ng-model="addData.date" />
			</div>
			<div class="td">
				<input ng-model="addData.memo" placeholder="{{i18n.record.momo_placeholder}}">
			</div>
			<div class="td">
				<select id="typeList" ng-model="addData.typeSelection"  ng-change="typeSelectionChange(addData)" ng-options="type as type.type_label for type in typeQuickSelectList(addData.cashType)">
					<option disabled value>{{i18n.record.type}}</option>
				</select>
				<div class="btn-showTypeMaps" ng-click="showTypeMaps(addData)"></div>
			</div>
			<div ng-if="addData.typesLength" class="td td-types_block">
				<div class="block-type-row" ng-repeat="type in addData.types" ng-click="removeTypes(type,addData)">
					<span>{{type.type_label}}</span>
				</div>
			</div>
		</div>
	</div>

	<div id="record-queryFilter">
		<div class="record-queryFilter-title">{{i18n.record.queryFilter}}</div>
		<div class="btn-recover" ng-click="getRecords()"></div>	
		<div class="record-queryFilter-panel">
			<div class="table">
				<div class="td td-type">
					<select id="cashType" ng-change="cleanTypes(filter)" ng-model="filter.cashType">
						<option value=null>{{i18n.record.cost_income}}</option>
						<option value="-1">{{i18n.record.cost}}</option>
						<option value="1">{{i18n.record.income}}</option>
					</select>
				</div>
				<div class="td td-value {{filter.invalidValue?'error':''}}">
					<input ng-model="filter.value_greater" placeholder="{{i18n.record.value_placeholder}}">
					~
					<input ng-model="filter.value_less" placeholder="{{i18n.record.value_placeholder}}">
				</div>

				<div class="td">
					<select id="typeList" ng-model="filter.cid"  ng-options="currency.cid as str.to_cid(currency) for currency in currencyQuickSelectList()">
						<option value="">{{i18n.record.selectCurrency}}</option>
					</select>
				</div>

				<div class="td {{filter.invalidDate?'error':''}}">
					<input class="cell" type="date" placeholder="{{i18n.record.date_placeholder}}" ng-model="filter.start_date" />
					~
					<input class="cell" type="date" placeholder="{{i18n.record.date_placeholder}}" ng-model="filter.end_date" />
				</div>
				<div class="td">
					<input ng-model="filter.memo" placeholder="{{i18n.record.momo_placeholder}}">
				</div>
			</div>
			<div class="table tb-typeQuery">
				<div class="td">
					<select id="typeQuerySet" ng-model="filter.type_query_set">
						<option value = "intersection">intersection</option>
						<option value = "union">union</option>
					</select>
				</div>
				<div class="td">
					<select id="typeList" ng-model="filter.typeSelection"  ng-change="typeSelectionChange(filter)" ng-options="type as type.type_label for type in typeFilterSelectList(filter.cashType)">
						<option value>{{ str.filterSelectType()}}</option>
					</select>
					<div class="btn-showTypeMaps" ng-click="showTypeMaps(filter)"></div>
				</div>
				<div ng-if="filter.typesLength"  class="td">
					<input id="absoluteQuery" ng-model="filter.absoluteQuery" type="checkbox" />{{i18n.record.absoluteQuery}}
				</div>
				<div ng-if="filter.typesLength" class="td td-types_block">
					<div class="block-type-row" ng-repeat="type in filter.types" ng-click="removeTypes(type,filter)">
						<span>{{type.type_label}}</span>
					</div>
				</div>
			</div>
			<div class="table">
				<div class="td">
					<select ng-model="filter.orderCol">
						<option value="rid">{{i18n.record.rid}}</option>
						<option value="date">{{i18n.record.date}}</option>
					</select>
					<select ng-model="filter.orderBy">
						<option value="ASC">{{i18n.record.ASC}}</option>
						<option value="DESC">{{i18n.record.DESC}}</option>
					</select>
					<select ng-model="filter.limit">
						<option value="10">10 {{i18n.record.records}}</option>
						<option value="20">20 {{i18n.record.records}}</option>
						<option value="50">50 {{i18n.record.records}}</option>
						<option value="100">100 {{i18n.record.records}}</option>
						<option value="">{{i18n.record.unlimit}} {{i18n.record.records}}</option>
					</select>				
				</div>
			</div>
		</div>
	</div>

	<div ng-if="records===ubdefiend">loading...</div>
	<div ng-if="records.length===0">null</div>
	<div id="showRecordPanel" ng-if="records">

		<div id="recordSummary">
			<div class="record-summary-total" ng-init="summaries = totalSummary"  ng-include="'recordSummaryTree'"></div>
			<div ng-if="showTypeSummary" class="record-summary-type" >
				<ul class="record-summary-type-Wrapper">
					<if ng-repeat="typeMap in typeMaps" >
						<li ng-if="summaryFlatMaps[typeMap.data.tid].summary" class="record-summary-type-top-li"  ng-include="'recordSummaryTypeTree'"></li>
					</if>
				</ul>				
			</div>
			<div class="{{showTypeSummary?'btn-up-arrow' : 'btn-down-arrow'}}" ng-click="swtichShowTypeSummary()" ></div>
		</div>

		<div ng-repeat="record in records.slice(0,renderLimit)" ng-include="'recordTree'"></div>
	</div>
	<div ng-if="records.length > renderLimit" class="btn-more" ng-click="addRenderLimit()"></div>
</div>

<script type="text/ng-template" id="recordSummaryTree">
	<div ng-repeat="summary in summaries">
		<div class="record-summary {{summary.sum<0 ? 'cost' : 'income'}}">
			<div class="record-summary-label">{{summary.label}}</div>
			<div class="record-summary-length">{{summary.length}} {{i18n.record.records}}</div>
			<div ng-if="summary.income" class="record-summary-income">
				{{i18n.record.income}} : {{summary.income}}
			</div>
			<div ng-if="summary.cost" class="record-summary-cost">
				{{i18n.record.cost}} : {{summary.cost}}
			</div>
			<div ng-if="summary.cost && summary.income"
				class="record-summary-sum">{{i18n.record.sum}} : {{summary.sum}}
			</div>
		</div>
	</div>
</script>

<script type="text/ng-template" id="recordSummaryTypeTree">
	<span class="record-summary-type-label">{{typeMap.data.type_label}}</span>
	<div class="record-summary-type-wrapper">
		<div ng-include="'recordSummaryTree'" ng-init="summaries = summaryFlatMaps[typeMap.data.tid].summary"></div>
	</div>
    <ul  class="record-summary-type-Wrapper" ng-if="typeMap.sub">
		<if ng-repeat="typeMap in typeMap.sub.list" ng-init="sup_tid = type.tid">
			<li ng-if="summaryFlatMaps[typeMap.data.tid].summary" class="record-summary-type-sub-li"  ng-include="'recordSummaryTypeTree'"></li>
		</if>
    </ul>
</script>

<script type="text/ng-template" id="recordTree">
		<div class="table {{record.cashType == 1 ? 'row-income' : 'row-cost' }}{{record.doubleCheckDelete? ' doubleCheckDelete' : ''}}{{record.isDeleted? ' isDeleted' : ''}}">
			<div class="td-operate">
				<div ng-if="!record.isDeleted && !record.doubleCheckDelete">
					<div class="btn-delete" ng-click="record.doubleCheckDelete = true;"></div>
					<div ng-if="record.isChange" class="btn-save" ng-click="updateItem(record)"></div>
				</div>
				<div ng-if="!record.isDeleted && record.doubleCheckDelete" class="btn-delete-confirm">
					<div class="btn-delete-cancle" ng-click="record.doubleCheckDelete = false;"></div>
					<div class="btn-delete-check" ng-click="deleteItem(record)"></div>					
				</div>
				<div ng-if="record.isDeleted">
					<div class="btn-recover" ng-click="addRecord(record)"></div>					
				</div>
			</div>
			<div class="td td-type">
				<select id="cashType" ng-change="record.isChange=true; cleanTypes(record);" ng-model="record.cashType">
					<option value="-1">{{i18n.record.cost}}</option>
					<option value="1">{{i18n.record.income}}</option>
				</select>
			</div>
			<div class="td td-value {{ ( !record.value || record.invalidValue ) ?'error':''}}">
				<input ng-change="record.isChange=true;" ng-model="record.value" placeholder="{{i18n.record.value_placeholder}}">
			</div>
			<div class="td td-currency">
				<select id="currencyList" ng-model="record.cid"  ng-change="record.isChange=true;" ng-options="currency.cid as str.to_cid(currency) for currency in currencyQuickSelectList()">
				</select>
			</div>
			<div class="td {{ (!record.date || record.invalidDate)?'error':''}}">
				<input ng-change="record.isChange=true;" class="cell" type="date" placeholder="{{i18n.record.date_placeholder}}" ng-model="record.date" />
			</div>
			<div class="td">
				<input ng-change="record.isChange=true;" ng-model="record.memo" placeholder="{{i18n.record.momo_placeholder}}">
			</div>
			<div class="td">
				<select id="typeList" ng-model="record.typeSelection"  ng-change="record.isChange=true; typeSelectionChange(record)" ng-options="type as type.type_label for type in typeQuickSelectList(record.cashType)">
					<option disabled value>{{i18n.record.type}}</option>
				</select>
				<div class="btn-showTypeMaps" ng-click="showTypeMaps(record)"></div>
			</div>
			<div ng-if="record.typesLength" class="td td-types_block">
				<div class="block-type-row" ng-repeat="type in record.types" ng-click="record.isChange=true; removeTypes(type,record);">
					<span>{{type.type_label}}</span>
				</div>
			</div>
		</div>
</script>
